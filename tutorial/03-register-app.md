---
ms.openlocfilehash: 0c9c6703a54e50f576a171a4a161305c9b9ae6ff
ms.sourcegitcommit: 57a5c2e1a562d8af092a3e78786d711ce1e8f9cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "48822728"
---
<!-- markdownlint-disable MD002 MD041 -->

В этом упражнении вы создадите три новых приложения Azure AD с помощью центра администрирования Azure Active Directory:

- Регистрация приложения для одностраничного приложения, чтобы она могла выполнять вход в систему и получать маркеры, позволяющие приложению вызывать функцию Azure.
- Регистрация приложения для функции Azure, позволяющая использовать потоки "от [имени](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) " для обмена маркером, отправляемым SPA для маркера, который позволит ему вызвать Microsoft Graph.
- Регистрация приложения для веб-перехватчика функции Azure, которая позволяет ему использовать [потоки учетных данных клиента](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-client-creds-grant-flow) для вызова Microsoft Graph без пользователя.

> [!NOTE]
> В этом примере требуется три регистрации приложений, так как он реализует как потоки "от имени", так и потоки учетных данных клиента. Если функция Azure использует только один из этих потоков, необходимо создать только регистрации приложений, соответствующие этому потоку.

1. Откройте браузер и перейдите в [центр администрирования Azure Active Directory](https://aad.portal.azure.com) и войдите в систему с помощью администратора организации клиента Microsoft 365.

1. Выберите **Azure Active Directory** на панели навигации слева, затем выберите **Регистрация приложений** в разделе **Управление**.

    ![Снимок экрана с регистрациями приложений ](./images/aad-portal-app-registrations.png)

## <a name="register-an-app-for-the-single-page-application"></a>Регистрация приложения для одностраничного приложения

1. Выберите **Новая регистрация**. На странице **Зарегистрировать приложение** задайте необходимые значения следующим образом.

    - Введите **имя** `Graph Azure Function Test App`.
    - Установите **Поддерживаемые типы учетных** записей **только для учетных записей в данном организационном каталоге**.
    - В разделе **URI перенаправления** измените раскрывающийся список на **одностраничное приложение (SPA)** и задайте для него значение `http://localhost:8080` .

    ![Снимок страницы "регистрация приложения"](./images/register-command-line-app.png)

1. Нажмите **Зарегистрировать**. На странице **приложения-приложения Graph Graph** , СКОПИРУЙТЕ значения **идентификатора Application (Client)** и **идентификатора каталога (клиента)** и сохраните их, они понадобятся позже.

    ![Снимок экрана с ИДЕНТИФИКАТОРом приложения для новой регистрации приложения](./images/aad-application-id.png)

## <a name="register-an-app-for-the-azure-function"></a>Регистрация приложения для функции Azure

1. Вернитесь к **регистрациям приложений** и выберите пункт **создать регистрацию**. На странице **Зарегистрировать приложение** задайте необходимые значения следующим образом.

    - Введите **имя** `Graph Azure Function`.
    - Установите **Поддерживаемые типы учетных** записей **только для учетных записей в данном организационном каталоге**.
    - Оставьте пустым **URI перенаправления** .

1. Нажмите **Зарегистрировать**. На странице " **функция Graph Azure** " СКОПИРУЙТЕ значение **идентификатора Application (Client)** и сохраните его, он понадобится на следующем шаге.

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание** и выберите один из вариантов **истечения срока действия** , а затем нажмите кнопку **добавить**.

    ![Снимок экрана: диалоговое окно добавления секрета клиента](./images/aad-new-client-secret.png)

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Оно вам понадобится на следующем шаге.

    > [!IMPORTANT]
    > Это секрет клиента, он никогда не отображается еще раз, поэтому убедитесь, что вы скопировали его.

    ![Снимок экрана с недавно добавленным секретом клиента](./images/aad-copy-client-secret.png)

1. Выберите **разрешения API** в разделе **Управление**. Нажмите кнопку **Добавить разрешение**.

1. Выберите **Microsoft Graph** , а затем **делегированные разрешения**. Добавить **почту. Read** и выберите команду **Добавить разрешения**.

    ![Снимок экрана с настроенными разрешениями для регистрации приложения функции Azure](./images/web-api-configured-permissions.png)

1. Выберите **открыть доступ к API** в разделе **Управление** , а затем выберите **Добавить область**.

1. Примите **URI идентификатора приложения** по умолчанию и нажмите кнопку **сохранить и продолжить**.

1. Заполните форму **Добавить область** следующим образом:

    - **Имя области:** Mail. Read
    - **Кто может согласиться?:** Администраторы и пользователи
    - **Отображаемое имя разрешения администратора:** Чтение входящих в папку "Входящие" пользователей
    - **Описание согласия администратора:** Позволяет приложению считывать папки "Входящие" всех пользователей
    - **Отображаемое имя согласия пользователя:** Чтение папки "Входящие"
    - **Описание согласия пользователя:** Позволяет приложению читать папку "Входящие"
    - **Состояние:** Доступ

1. Нажмите кнопку **Добавить область**.

1. Скопируйте новую область, а затем потребуются ее на последующих этапах.

    ![Снимок экрана с определенными областями для регистрации приложения функции Azure](./images/web-api-defined-scopes.png)

1. Выберите **Манифест** в разделе **Управление**.

1. Выберите `knownClientApplications` в манифесте и замените текущее значение `[]` на `[TEST_APP_ID]` , где `TEST_APP_ID` — это идентификатор приложения, в котором находится приложение **функции Graph Test App Registration App** . Выберите **Сохранить**.

> [!NOTE]
> Добавление идентификатора приложения тестового приложения в `knownClientApplications` свойство в манифесте функции Azure позволяет тестовому приложению инициировать [общий ход разрешения](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow#default-and-combined-consent). Это необходимо для работы процесса "от имени".

## <a name="add-azure-function-scope-to-test-application-registration"></a>Добавление области функции Azure для проверки регистрации приложения

1. Вернитесь к **функции Graph Test App** Registration и выберите **разрешения API** в разделе **Управление**. Выберите **Добавить разрешение**.

1. Выберите **Мои API** , а затем нажмите кнопку **загрузить еще больше**. Выберите **функция Graph Azure**.

    ![Снимок экрана: диалоговое окно разрешений API запроса](./images/test-app-add-permissions.png)

1. Выберите разрешение **почта. чтение** и нажмите кнопку **Добавить разрешения**.

1. В разделе **настроенные разрешения** удалите разрешение **User. Read** для **Microsoft Graph** , выбрав элемент **...** справа от разрешения и выбрав пункт **удалить разрешение**. Нажмите кнопку **Да, удалить** для подтверждения.

    ![Снимок экрана с настроенными разрешениями для проверки регистрации приложения приложения](./images/test-app-configured-permissions.png)

## <a name="register-an-app-for-the-azure-function-webhook"></a>Регистрация приложения для веб-перехватчика функции Azure

1. Вернитесь к **регистрациям приложений** и выберите пункт **создать регистрацию**. На странице **Зарегистрировать приложение** задайте необходимые значения следующим образом.

    - Введите **имя** `Graph Azure Function Webhook`.
    - Установите **Поддерживаемые типы учетных** записей **только для учетных записей в данном организационном каталоге**.
    - Оставьте пустым **URI перенаправления** .

1. Нажмите **Зарегистрировать**. На странице веб- **перехватчик функции Graph Azure** СКОПИРУЙТЕ значение **идентификатора Application (Client)** и сохраните его, он понадобится на следующем шаге.

1. Выберите **Сертификаты и секреты** в разделе **Управление**. Нажмите кнопку **Новый секрет клиента**. Введите значение в поле **Описание** и выберите один из вариантов **истечения срока действия** , а затем нажмите кнопку **добавить**.

1. Скопируйте значение секрета клиента, а затем покиньте эту страницу. Оно вам понадобится на следующем шаге.

1. Выберите **разрешения API** в разделе **Управление**. Нажмите кнопку **Добавить разрешение**.

1. Выберите **Microsoft Graph** , а затем — **разрешения приложений**. Добавьте **User. Read. ALL** и **mail. Read** , а затем выберите **Добавить разрешения**.

1. В **настроенных разрешениях** удалите делегированного **пользователя.** разрешение на чтение **в Microsoft Graph** , выбрав элемент **...** справа от разрешения и выбрав пункт **удалить разрешение**. Нажмите кнопку **Да, удалить** для подтверждения.

1. Нажмите кнопку **предоставить согласие администратора для...** , а затем выберите **Да** , чтобы предоставить согласие администратора для настроенных разрешений приложения. В столбце **состояние** в **настроенной таблице разрешений** изменяется значение **предоставлено для...**.

    ![Снимок экрана с настроенными разрешениями для веб-перехватчика с предоставлением разрешения администратора](./images/webhook-configured-permissions.png)
